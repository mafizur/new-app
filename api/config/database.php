<?php

/*
 * This file is part of the Slim API skeleton package
 *
 * Copyright (c) 2016 Mika Tuupola
 *
 * Licensed under the MIT license:
 *   http://www.opensource.org/licenses/mit-license.php
 *
 * Project home:
 *   https://github.com/tuupola/slim-api-skeleton
 *
 */

$container = $app->getContainer();

$container["spot"] = function ($container) {

    $config = new \Spot\Config();
    $mysql = $config->addConnection("mysql", [
        "dbname" => getenv("DB_NAME"),
        "user" => getenv("DB_USER"),
        "password" => getenv("DB_PASSWORD"),
        "host" => getenv("DB_HOST"),
        "driver" => "pdo_mysql",
        "charset" => "utf8"
    ]);

    $spot = new \Spot\Locator($config);

    $logger = new Doctrine\DBAL\Logging\MonologSQLLogger($container["logger"]);
    $mysql->getConfiguration()->setSQLLogger($logger);

    return $spot;
};

$container["db"] = function () {
    $dsn = 'mysql:host='.getenv("DB_HOST").';dbname='.getenv("DB_NAME").';charset=utf8';
    $usr = getenv("DB_USER");
    $pwd = getenv("DB_PASSWORD");

    $pdo = new \Slim\PDO\Database($dsn, $usr, $pwd);

    return $pdo;
};
